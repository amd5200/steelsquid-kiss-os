<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
    <head>
        <title>Kiss OS Utils</title>
        <meta http-equiv="Content-Language" content="en" />
        <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
        <meta name="Steelsquid Kiss OS" content="Controll a rover from the web." />
        <meta name="keywords" content="steelsquid, steelsquid-kiss-os, raspberry, pi, debian, linux, distribution, administrator, configure" />
        <meta name="author" content="Andreas Nilsson (Steelsquid)" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
        <link rel="icon" href="favicon.ico" type="image/x-icon"/>
        <link rel="shortcut icon" href="favicon.ico" type="image/x-icon"/>
        <link rel="stylesheet" type="text/css" href="steelsquid.css"/>
        <script type="text/javascript" src="jquery.js"></script>
        <script type="text/javascript" src="steelsquid.js"></script>     
        <style>
            a.toggler {
                background: green;
                cursor: pointer;
                border: 2px solid black;
                border-right-width: 15px;
                padding: 0 5px;
                border-radius: 5px;
                text-decoration: none;
                transition: all .5s ease;
            }

            a.toggler.arm {
                background: red;
                border-right-width: 2px;
                border-left-width: 15px;
            }
        </style>
        <script type="text/javascript">
            //<![CDATA[ 
            
            var stream_port="8080";
            
            $(document).ready(function(){
                $('a.toggler').click(function(){
                    $(this).toggleClass('arm');
                    if($(this).hasClass('arm')){
                        $("#toggler_text").html("<span  class='error'>Security alarm armed!</span>");
                        submitNoPW('alarm_arm', 'true');
                    }
                    else{
                        $("#toggler_text").html("<span  class='ok'>Security alarm disarmed!</span>");
                        submitNoPW('alarm_arm', 'false');
                    }
                });
            });            

            /**
             * When the page is in front
             */
            function onVisible(){
                if (isLayerShowing('stream') || isLayerShowing('rover')){
                    $("#stream_img").attr("src", "http://"+window.location.hostname+":"+stream_port+"/?action=stream");         
                }
                else if (isLayerShowing('alarm')){
                    $("#alarm_img").attr("src", "http://"+window.location.hostname+":"+stream_port+"/?action=stream");         
                }
            }

            /**
             * When the page is in background
             */
            function onHidden(){
                if (isLayerShowing('stream') || isLayerShowing('rover')){
                    $("#stream_img").attr("src", "");         
                }
                else if (isLayerShowing('alarm')){
                    $("#alarm_img").attr("src", "");         
                }
            }
                    

            /**
             * When the page is loaded
             */
            function onPageLoad(){
                showLayer('main');
            }
            
            /**
             * When go back or middle mouse button or esc pressed
             */
            function onBack(){
                showLayer('main');
            }

            /**
             * This will execute every 1 second
             */
            function onEvery01s(){
                if(isVisible()){
                    if (isLayerShowing('alarm')){
                        submitNoPW('alarm_status');
                    }
                }
            }

            /**
             * This will execute every 5 second
             */
            function onEvery05s(){
                if(isVisible()){
                    if (isLayerShowing('stream') || isLayerShowing('rover')){
                        $("#stream_img").attr("src", "http://"+window.location.hostname+":"+stream_port+"/?action=stream");         
                    }
                    else if (isLayerShowing('alarm')){
                        $("#alarm_img").attr("src", "http://"+window.location.hostname+":"+stream_port+"/?action=stream");         
                    }
                    else if(isLayerShowing("socket")){
                        submitNoPW('socket_info');
                    }
                    else if(isLayerShowing("alarm_server")){
                        submitNoPW('alarm_server_statuses');
                    }
                }
            }

            /**
             * This will execute every 30 second
             */
            function onEvery30s(){
                if(isVisible()){
                    if (isLayerShowing('rover')){
                        submitNoPW('rover_info');
                    }
                }
            }

            /**
             * When a layer is shown
             */
            function onLayerShown(layer){
                if(layer == "stream"){
                    submitNoPW('stream_port');
                    submitNoPW('stream');
                }
                else if(layer == "rover"){
                    submitNoPW('stream_port');
                    submitNoPW('rover_info');
                    $("#rover_img").attr("src", "http://"+window.location.hostname+":"+stream_port+"/?action=stream");       
                }
                else if(layer == "alarm"){
                    submitNoPW('stream_port');
                    submitNoPW('alarm');
                    submitNoPW('alarm_status');
                    submitNoPW('hostname_get');
                    submitNoPW('alarm_settings');
                    submitNoPW('socket_info');
                    $("#alarm_img").attr("src", "http://"+window.location.hostname+":"+stream_port+"/?action=stream");         
                }
                else if(layer == "alarm_server"){
                    submitNoPW('alarm_server');
                    submitNoPW('alarm_server_statuses');
                }
                else if(layer == "mail"){
                    submitSync('mail_get');
                }
            }           

            /**
             * On stream
             */
            function on_stream(paramaters){
                if(paramaters[0] == "usb"){
                    show('stream_enabled_usb');
                    hide('stream_enabled_pi');
                    hide('stream_disabled');
                    $("#stream_img").attr("src", "http://"+window.location.hostname+":"+stream_port+"/?action=stream");         
                    $("#video_link").attr("href", "http://"+window.location.hostname+":"+stream_port+"/?action=stream");         
                    $("#video_link").html("http://"+window.location.hostname+":"+stream_port+"/?action=stream");
                    $("#picture_link").attr("href", "http://"+window.location.hostname+":"+stream_port+"/?action=snapshot");         
                    $("#picture_link").html("http://"+window.location.hostname+":"+stream_port+"/?action=snapshot");
                }
                else if(paramaters[0] == "pi"){
                    show('stream_enabled_pi');
                    hide('stream_enabled_usb');
                    hide('stream_disabled');
                    $("#stream_img_pi").attr("src", "http://"+window.location.hostname+":"+stream_port+"/?action=stream");         
                    $("#video_link_pi").attr("href", "http://"+window.location.hostname+":"+stream_port+"/?action=stream");         
                    $("#video_link_pi").html("http://"+window.location.hostname+":"+stream_port+"/?action=stream");
                    $("#picture_link_pi").attr("href", "http://"+window.location.hostname+":"+stream_port+"/?action=snapshot");         
                    $("#picture_link_pi").html("http://"+window.location.hostname+":"+stream_port+"/?action=snapshot");
                }
                else{
                    hide('stream_enabled_usb');
                    hide('stream_enabled_pi');
                    show('stream_disabled');
                }
            }
            
            /**
             * stream port
             */
            function on_stream_port(paramaters){
                stream_port=paramaters[0];
            }
            
            
            /**
             * On alarm
             */
            function on_alarm(paramaters){
                if(paramaters[0] == "true"){
                    show('alarm_enabled');
                    hide('alarm_disabled');
                    $("#alarm_img").attr("src", "http://"+window.location.hostname+":"+stream_port+"/?action=stream");         
                }
                else{
                    hide('alarm_enabled');
                    show('alarm_disabled');
                }
            }


            /**
             * On alarm
             */
            function on_alarm_status(paramaters){
                if(paramaters[0] == "true"){
                    $("#alarm_motion").html("<span class='error'>Motion detected!!!</span>");
                }
                else{
                    $("#alarm_motion").html("No motion detected");
                }
                if(paramaters[1] == "true"){
                    $("#alarm_siren").html("<span class='error'>Activated!!!</span>");
                    $("#alarm_siren_button").html("<button onclick=\"javascript:submitSync('alarm_siren', 'false')\">Deactivate siren</button>");
                }
                else{
                    $("#alarm_siren").html("Silent");
                    $("#alarm_siren_button").html("<button onclick=\"javascript:submitSync('alarm_siren', 'true')\">Activate siren</button>");
                }
                if(paramaters[2] == "true"){
                    $("#alarm_lamp").html("<span class='error'>Lit!!!</span>");
                    $("#alarm_lamp_button").html("<button onclick=\"javascript:submitSync('alarm_lamp', 'false')\">Turn off the IR lamp</button>");
                }
                else{
                    $("#alarm_lamp").html("Off");
                    $("#alarm_lamp_button").html("<button onclick=\"javascript:submitSync('alarm_lamp', 'true')\">Turn on the IR lamp</button>");
                }
                if(paramaters[3] == "true"){
                    $("#alarm_triggered").html("<span class='error' style='font-size:10pt'><b>Alarm is triggered!!!</b></span>");
                    $("#toggler").addClass('arm');
                    $("#toggler_text").html("<span  class='error'>Security alarm armed!</span>");
                }
                else if(paramaters[4] == "false"){
                    $("#alarm_triggered").html("<span class='ok' style='font-size:10pt'><b>Security alarm not activated (Disarmed)</b></span>");
                    $("#toggler").removeClass('arm');
                    $("#toggler_text").html("<span  class='ok'>Security alarm disarmed!</span>");
                }
                else{
                    $("#alarm_triggered").html("<span class='ok' style='font-size:10pt'><b>Security alarm activated (Armed)</b></span>");
                    $("#toggler").addClass('arm');
                    $("#toggler_text").html("<span  class='error'>Security alarm armed!</span>");
                }
                $("#alarm_light").html(paramaters[5]);
                $("#alarm_temperature").html(paramaters[6]);
                $("#alarm_humidity").html(paramaters[7]);
                
            }


            function on_alarm_arm(paramaters){
                if(paramaters[0] == "True"){
                    $("#alarm_triggered").html("<span class='ok' style='font-size:10pt'><b>Security alarm activated (Armed)</b></span>");
                    $("#toggler").addClass('arm');
                    $("#toggler_text").html("<span  class='error'>Security alarm armed!</span>");
                }
                else{
                    $("#alarm_triggered").html("<span class='ok' style='font-size:10pt'><b>Security alarm not activated (Disarmed)</b></span>");
                    $("#toggler").removeClass('arm');
                    $("#toggler_text").html("<span  class='ok'>Security alarm disarmed!</span>");
                }
            }

            /**
             * socket
             */
            function on_socket_info(paramaters){
                if(paramaters[0]=="server"){
                    disable("socket_button_server");
                    enable("socket_button_client");
                    enable("socket_button_disable");
                    disable("socket_button_disable_client");
                    enable("socket_button_disable_server");
                }
                else if(paramaters[0]=="client"){
                    enable("socket_button_server");
                    enable("socket_button_client");
                    enable("socket_button_disable");
                    enable("socket_button_disable_client");
                    disable("socket_button_disable_server");
                    $("#socket_client_host").val(paramaters[2])
                }
                else{
                    enable("socket_button_server");
                    enable("socket_button_client");
                    disable("socket_button_disable_client");
                    disable("socket_button_disable_server");
                    $("#socket_client_host").val("")
                }
                $("#socket_connections").html(paramaters[3]);
                $("#socket_info").html(paramaters[1]);
            }

            /**
             * On alarm
             */
            function on_alarm_settings(paramaters){
                if(paramaters[0]=="True"){
                    showAlertMedium("Settings saved", false);
                }
                $("#alarm_movments").val(paramaters[1]);
                $("#alarm_movments_seconds").val(paramaters[2]);
                $("#alarm_seconds").val(paramaters[3]);
                $("#alarm_wait").val(paramaters[4]);
                if(paramaters[5]=="True"){
                    $("#alarm_activate_siren").prop("checked", true)
                }    
                if(paramaters[6]=="True"){
                    $("#alarm_mail").prop("checked", true)
                }    
                $("#alarm_light_acivate").val(paramaters[7]);                
                if(paramaters[7]=="True"){
                    $("#alarm_remote_siren").prop("checked", true)
                }    
            }


            /**
             * Hostname
             */
            function on_hostname_get(paramaters){
                setValue("hostname_name", paramaters[0]);
            }


            /**
             * On alarm_server
             */
            function on_alarm_server(paramaters){
                if(paramaters[0] == "True"){
                    if(paramaters[1] != "server"){
                        hide('alarm_server_disabled');
                        show('alarm_server_not_server');
                        hide('alarm_server_enabled');
                    }
                    else{
                        hide('alarm_server_disabled');
                        hide('alarm_server_not_server');
                        show('alarm_server_enabled');
                    }
                }
                else{
                    show('alarm_server_disabled');
                    hide('alarm_server_not_server');
                    hide('alarm_server_enabled');
                }
            }
            
            /**
             * Answer when change status of client connected to this server.
             */
            function on_alarm_client_set(paramaters){
                submitNoPW('alarm_server_statuses');
            }
            

            var isFirst = true;
            
            /**
             * On alarm_server_statuses
             */
            function on_alarm_server_statuses(paramaters){
                if(isFirst){
                    var html = [];
                    for(i = 0; i<paramaters.length; i++){
                        isFirst = false;
                        ip = paramaters[i];
                        i++;
                        name = paramaters[i];
                        i++;
                        armed = paramaters[i];
                        i++;
                        alarm_triggered = paramaters[i];
                        i++;
                        motion_detected = paramaters[i];
                        i++;
                        is_siren_on = paramaters[i];
                        i++;
                        is_lamp_on = paramaters[i];
                        i++;
                        light_level = paramaters[i];
                        i++;
                        temperature = paramaters[i];
                        i++;
                        humidity = paramaters[i];

                        
                        alarm_string="";
                        if(alarm_triggered=="True"){
                            alarm_string = "<b><span class='flash'>Alarm is triggered!!!</span></b>";
                        }
                        else if(armed=="True"){
                            alarm_string = "<b><span class='error'>Security alarm armed!</span></b>";
                        }
                        else{
                            alarm_string = "<b><span class='ok'>Security alarm disarmed</span></b>";
                        }

                        motion_string="";
                        if(motion_detected=="True"){
                            motion_string = "<span class='error'>Motion detected!</span>";
                        }
                        else{
                            motion_string = "<span class='ok'>No motion detected</span>";
                        }

                        siren_string="";
                        if(is_siren_on=="True"){
                            siren_string = "<span class='error'>Sounding!</span>";
                        }
                        else{
                            siren_string = "<span class='ok'>Silent</span>";
                        }

                        lamp_string="";
                        if(is_lamp_on=="True"){
                            lamp_string = "<span class='ok'>On</span>";
                        }
                        else{
                            lamp_string = "<span class='ok'>Off</span>";
                        }
                        html.push(
                            "<tr><td>",
                                "<span style='font-size:large;font-weight: bold;' id='name_",ip,"'>",
                                    name,
                                "</span>",
                                "<br/>",
                                "<a id='href_",ip,"' href='snapshots/",ip,".jpg?rand=",Math.random(),"' target='_blank'><img id='snap_",ip,"' src='snapshots/",ip,".jpg?rand=",Math.random(),"' style='width: 225px'/></a>",
                                "<table class='grid' style='width:225px'>",
                                    "<tr>",
                                        "<td style='padding-right:4px;width:50%'>",
                                            "<button onclick=\"javascript:submitSync('alarm_client_set', '",ip,"', 'True');\">Arm</button>",
                                        "</td>",
                                        "<td style='padding-left:4px;width:50%'>",
                                            "<button onclick=\"javascript:submitSync('alarm_client_set', '",ip,"', 'False');\">Disarm</button>",
                                        "</td>",
                                    "</tr>",
                                "</table>",
                                "<table class='grid'>",
                                    "<tr>",
                                        "<td colspan='2' id='alarm_",ip,"'>",
                                            alarm_string,
                                        "</td>",
                                    "</tr>",
                                "</table>",
                                "<table class='grid'>",
                                    "<tr>",
                                        "<td style='white-space: nowrap;padding-right:8px'>",
                                            "IP:",
                                        "</td>",
                                        "<td style='width:100%'>",
                                            "<span class='ok'>",
                                                ip,
                                            "</span>",
                                        "</td>",
                                    "</tr>",
                                "</table>",
                                "<table class='grid'>",
                                    "<tr>",
                                        "<td style='white-space: nowrap;padding-right:8px'>",
                                            "Motion:",
                                        "</td>",
                                        "<td style='width:100%' id='motion_",ip,"'>",
                                            motion_string,
                                        "</td>",
                                    "</tr>",
                                "</table>",
                                "<table class='grid'>",
                                    "<tr>",
                                        "<td style='white-space: nowrap;padding-right:8px'>",
                                            "Siren/IR lamp:",
                                        "</td>",
                                        "<td id='siren_",ip,"'>",
                                            siren_string,
                                        "</td>",
                                        "<td>",
                                            "/",
                                        "</td>",
                                        "<td id='lamp_",ip,"'>",
                                            lamp_string,
                                        "</td>",
                                        "<td style='width:100%' id='lamp_",ip,"'>",
                                        "</td>",
                                    "</tr>",
                                "</table>",
                                "<table class='grid'>",
                                    "<tr>",
                                        "<td style='white-space: nowrap;padding-right:8px'>",
                                            "Light/Temp/Hum:",
                                        "</td>",
                                        "<td style='width:100%'>",
                                            "<span class='ok' id='light_",ip,"'>",
                                                light_level,
                                            "</span>",
                                            "/",
                                            "<span class='ok' id='temp_",ip,"'>",
                                                temperature,
                                                "C",
                                            "</span>",
                                            "/",
                                            "<span class='ok' id='hum_",ip,"'>",
                                                humidity,
                                                "%",
                                            "</span>",
                                        "</td>",
                                    "</tr>",
                                "</table>",
                                "<br/>",
                            "</td></tr>"
                        );
                    }

                    tbody = $("#alarm_server_statuses").find('tbody');
                    tbody.html(html.join(""));
                }
                else{
                    for(i = 0; i<paramaters.length; i++){
                        ip = paramaters[i];
                        i++;
                        name = paramaters[i];
                        i++;
                        armed = paramaters[i];
                        i++;
                        alarm_triggered = paramaters[i];
                        i++;
                        motion_detected = paramaters[i];
                        i++;
                        is_siren_on = paramaters[i];
                        i++;
                        is_lamp_on = paramaters[i];
                        i++;
                        light_level = paramaters[i];
                        i++;
                        temperature = paramaters[i];
                        i++;
                        humidity = paramaters[i];
                        try{
                            alarm_string="";
                            if(alarm_triggered=="True"){
                                alarm_string = "<b><span class='flash'>Alarm is triggered!!!</span></b>";
                            }
                            else if(armed=="True"){
                                alarm_string = "<b><span class='error'>Security alarm armed!</span></b>";
                            }
                            else{
                                alarm_string = "<b><span class='ok'>Security alarm disarmed</span></b>";
                            }
                            motion_string = ""
                            if(motion_detected=="True"){
                                motion_string = "<span class='error'>Motion detected!</span>";
                            }
                            else{
                                motion_string = "<span class='ok'>No motion detected</span>";
                            }

                            siren_string = ""
                            if(is_siren_on=="True"){
                                siren_string = "<span class='error'>Sounding!</span>";
                            }
                            else{
                                siren_string = "<span class='ok'>Silent</span>";
                            }

                            lamp_string = ""
                            if(is_lamp_on=="True"){
                                lamp_string = "<span class='ok'>On</span>";
                            }
                            else{
                                lamp_string = "<span class='ok'>Off</span>";
                            }
                            document.getElementById("name_"+ip).innerHTML = name;
                            document.getElementById("alarm_"+ip).innerHTML = alarm_string;
                            document.getElementById("motion_"+ip).innerHTML = motion_string;
                            document.getElementById("siren_"+ip).innerHTML = siren_string;
                            document.getElementById("lamp_"+ip).innerHTML = lamp_string;
                            document.getElementById("light_"+ip).innerHTML = light_level;
                            document.getElementById("temp_"+ip).innerHTML = temperature+"C";
                            document.getElementById("hum_"+ip).innerHTML = humidity+"%";
                            
                            document.getElementById("href_"+ip).setAttribute("href", "snapshots/"+ip+".jpg?rand=" + Math.random());
                            document.getElementById("snap_"+ip).src = "snapshots/"+ip+".jpg?rand=" + Math.random();
                        }
                        catch(eee){
                            isFirst = false;
                        }
                    }
                }
            }


            /**
             * Get mail 
             */
            function on_mail_get(paramaters){
                $("#mail_host").val(paramaters[0]);
                $("#mail_username").val(paramaters[1]);
                $("#mail_mail").val(paramaters[2]);
            }
            
            /**
             * Set mail 
             */
            function on_mail_set(paramaters){
                showAlertMedium("Settings saved", false);
            }
            
            /**
             * Test mail 
             */
            function on_mail_test(paramaters){
                showAlertMedium("A test mail is sent, check you mailbox", false);
            }

            
            /**
             * On rover
             */
            function on_rover_info(paramaters){
                if(paramaters[0] == "True"){
                    show('rover_enabled');
                    hide('rover_disabled');
                    $("#rover_voltage").html(paramaters[1]);
                    if(paramaters[2] == "True"){
                        $("#rover_light").html("Enabled");
                    }
                    else{
                        $("#rover_light").html("Disabled");
                    }
                    if(paramaters[3] == "True"){
                        $("#rover_alarm").html("Enabled");
                    }
                    else{
                        $("#rover_alarm").html("Disabled");
                    }
                }
                else{
                    hide('rover_enabled');
                    show('rover_disabled');
                }
            }

            /**
             * On rover
             */
            function on_rover_light(paramaters){
                if(paramaters[0] == "True"){
                    $("#rover_light").html("Enabled");
                }
                else{
                    $("#rover_light").html("Disabled");
                }
            }

            /**
             * On rover
             */
            function on_rover_alarm(paramaters){
                if(paramaters[0] == "True"){
                    $("#rover_alarm").html("Enabled");
                }
                else{
                    $("#rover_alarm").html("Disabled");
                }
            }
            
            /**
             * On rover
             */
            function on_rover_enable(paramaters){
                on_rover(paramaters);
            }
            
            /**
             * On rover
             */
            function on_rover_disable(paramaters){
                on_rover(paramaters);
            }

            //]]>
        </script>
        
    </head>
    <body>
        <table class="bar">
            <thead>
                <tr>
                    <td>
                        <img alt="logo" src="img/bar_steelsquid.png"></img>
                    </td>
                    <td>
                        Kiss OS Utils
                    </td>
                    <td>
                        <img alt="logo" src="img/bar_menu.png"></img>
                    </td>
                </tr>
            </thead>
            <tbody>
                <tr onclick="javascript:window.location = 'http://www.steelsquid.org/steelsquid-kiss-os';">
                    <td>
                        <img alt="logo" src="img/bar_help.png"></img>
                    </td>
                    <td colspan="2" >
                        Help
                    </td>
                </tr>
                <tr onclick="javascript:window.location = '/';">
                    <td>
                        <img alt="logo" src="img/bar_admin.png"></img>
                    </td>
                    <td colspan="2" >
                        Administrator
                    </td>
                </tr>
                <tr onclick="javascript:window.location = '/file';">
                    <td>
                        <img alt="logo" src="img/bar_file.png"></img>
                    </td>
                    <td colspan="2" >
                        File Manager
                    </td>
                </tr>
                <tr onclick="javascript:window.location = '/download';">
                    <td>
                        <img alt="logo" src="img/bar_download.png"></img>
                    </td>
                    <td colspan="2" >
                        Download Manager
                    </td>
                </tr>
                <tr onclick="javascript:window.location = '/play';">
                    <td>
                        <img alt="logo" src="img/bar_play.png"></img>
                    </td>
                    <td colspan="2" >
                        Media Player
                    </td>
                </tr>
                <tr onclick="javascript:window.location = '/expand';">
                    <td>
                        <img alt="logo" src="img/bar_expand.png"></img>
                    </td>
                    <td colspan="2" >
                        Expand
                    </td>
                </tr>
                <tr onclick="javascript:submitSyncConfirm('Are you sure you want to reboot?', 'reboot');">
                    <td>
                        <img alt="logo" src="img/bar_reboot.png"></img>
                    </td>
                    <td colspan="2" >
                        Reboot
                    </td>
                </tr>
                <tr onclick="javascript:submitSyncConfirm('Are you sure you want to shutdown?', 'shutdown');">
                    <td>
                        <img alt="logo" src="img/bar_shutdown.png"></img>
                    </td>
                    <td colspan="2" >
                        Shutdown
                    </td>
                </tr>
            </tbody>
        </table>
        <div class="flow">
            <div class="layer" id="main">
                <table class="menu">
                    <tbody>
                        <tr onclick="javascript:showLayer('stream');">
                            <td>
                                <img alt="logo" src="img/camera.png"></img>
                            </td>
                            <td>
                                Camera streaming
                            </td>
                        </tr>
                        <tr onclick="javascript:showLayer('alarm');">
                            <td>
                                <img alt="logo" src="img/alarm.png"></img>
                            </td>
                            <td>
                                Alarm/Surveillance
                            </td>
                        </tr>
                        <tr onclick="javascript:showLayer('alarm_server');">
                            <td>
                                <img alt="logo" src="img/alarm-panel.png"></img>
                            </td>
                            <td>
                                Alarm/Surveillance Server
                            </td>
                        </tr>
                        <tr onclick="javascript:showLayer('rover');">
                            <td>
                                <img alt="logo" src="img/rover.png"></img>
                            </td>
                            <td>
                                Rover Controller
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <!--####################################################################################################-->
            <div class="layer" id="stream">
                <table class="sheader">
                    <tr onclick="javascript:onBack();">
                        <th>
                            <img alt="logo" src="img/camera.png"></img>
                        </th>
                        <th>Camera streaming</th>
                    </tr>
                </table>
                <div id="stream_disabled" class="hide">
                    The USB or Raspberry PI web camera streaming is not enabled on this system.<br/>
                    Enable streaming may take a minute to perform and you need to reload this page afterwards (you may get connection error).<br/>
                    <br/>
                    <table>
                        <tr>
                            <td><button onclick="javascript:submitSyncConfirm('Are you sure you want to disable the streaming?', 'stream', 'usb');">Enable USB Streaming</button></td>
                            <td><button onclick="javascript:submitSyncConfirm('Are you sure you want to disable the streaming?', 'stream', 'pi');">Enable Raspberry PI Streaming</button></td>
                        </tr>
                    </table>
                </div>
                <div id="stream_enabled_usb" class="hide">
                    The USB web camera streaming is enabled on this system.<br/>
                    Below you should see the video from the USB camera.<br/>
                    If not, is it probably because your camera is not supported.<br/>
                    This is the url to the video: <a id="video_link" href=""></a><br>
                    This is the url to the still image: <a id="picture_link" href=""></a><br>
                    <br/>
                    <img alt="The stream" style="max-width: 100%; min-width: 100%" id="stream_img" src=""/>
                    <br/>
                    <table style="width:100%">
                        <tr>
                            <td style="width:50%"><button id="but_normal" style="text-decoration: underline;" onclick="javascript:$('#stream_img').removeClass('rotate-180');$('#but_normal').css({'text-decoration':'underline'});;$('#but_flip').css({'text-decoration':'none'});">Camera normal</button></td>
                            <td style="width:50%"><button id="but_flip" onclick="javascript:$('#stream_img').removeClass('rotate-180').addClass('rotate-180');$('#but_normal').css({'text-decoration':'none'});;$('#but_flip').css({'text-decoration':'underline'});">Camera rotate</button></td>
                        </tr>
                    </table>
                    <br/><br/>
                    Disable streaming may take a minute to perform and you need to reload this page afterwards (you may get connection error).<br/>
                    <table>
                        <tr>
                            <td><button onclick="javascript:submitSyncConfirm('Are you sure you want to disable the streaming?', 'stream', 'False');">Disable Streaming</button></td>
                            <td><button onclick="javascript:submitSyncConfirm('Are you sure you want to disable the streaming?', 'stream', 'pi');">Enable Raspberry PI Streaming</button></td>
                        </tr>
                    </table>
                </div>
                <div id="stream_enabled_pi" class="hide">
                    The Raspberry PI web camera streaming is enabled on this system.<br/>
                    Below you should see the video from the Raspberry PI camera.<br/>
                    This is the url to the video: <a id="video_link_pi" href=""></a><br>
                    This is the url to the still image: <a id="picture_link_pi" href=""></a><br>
                    <br/>
                    <img alt="The stream" id="stream_img_pi" style="max-width: 100%; min-width: 100%" src=""/>
                    <br/>
                    <table style="width:100%">
                        <tr>
                            <td style="width:50%"><button id="but_normal_pi" style="text-decoration: underline;" onclick="javascript:$('#stream_img_pi').removeClass('rotate-180');$('#but_normal').css({'text-decoration':'underline'});;$('#but_flip').css({'text-decoration':'none'});">Camera normal</button></td>
                            <td style="width:50%"><button id="but_flip_pi" onclick="javascript:$('#stream_img_pi').removeClass('rotate-180').addClass('rotate-180');$('#but_normal').css({'text-decoration':'none'});;$('#but_flip').css({'text-decoration':'underline'});">Camera rotate</button></td>
                        </tr>
                    </table>
                    <br/><br/>
                    Disable streaming may take a minute to perform and you need to reload this page afterwards (you may get connection error).<br/>
                    <table>
                        <tr>
                            <td><button onclick="javascript:submitSyncConfirm('Are you sure you want to disable the streaming?', 'stream', 'False');">Disable Streaming</button></td>
                            <td><button onclick="javascript:submitSyncConfirm('Are you sure you want to disable the streaming?', 'stream', 'usb');">Enable USB Streaming</button></td>
                        </tr>
                    </table>
                </div>
                <br />
                <table class="footer">
                    <tr onclick="javascript:onBack();">
                        <td>
                            <img alt="logo" src="img/back.png"></img>
                        </td>
                        <td>
                            Back to main menu
                        </td>
                    </tr>
                </table>
            </div>
            <!--####################################################################################################-->
            <div class="layer" id="alarm">
                <table class="sheader">
                    <tr onclick="javascript:onBack();">
                        <th>
                            <img alt="logo" src="img/alarm.png"></img>
                        </th>
                        <th>Alarm/Surveillance</th>
                    </tr>
                </table>
                <div id="alarm_disabled" class="hide">
                    The Alarm/Surveillance functionality is not enabled on this system.<br/>
                    For more info see <a href="http://www.steelsquid.org/alarm">http://www.steelsquid.org/alarm</a>
                    <br/><br/>
                    <table>
                        <tr>
                            <td><button onclick="javascript:submitSync('alarm', 'true');">Enable Alarm/Surveillance</button></td>
                        </tr>
                    </table>
                </div>
                <div id="alarm_enabled" class="hide">
                    The Alarm/Surveillance functionality is enabled on this system.<br/>
                    For this to work you need a Raspberry PI camera and other stuff connected to the GPIO.<br/>
                    For more info see <a href="http://www.steelsquid.org/alarm">http://www.steelsquid.org/alarm</a>
                    <br/><br/>
                    Push to Arm/Disarm: <a href="#" id="toggler" class="toggler">&nbsp;</a>&nbsp;&nbsp;<span id="toggler_text"></span>
                    <br/><br/>
                    <b>Camera and sensors</b>
                    <img alt="The stream" style="max-width: 100%; min-width: 100%" id="alarm_img" src=""/>
                    <br/>
                    <table class="keyvalue">
                        <tr>
                            <td>
                                Security alarm
                            </td>
                            <td id="alarm_triggered">
                            </td>
                        </tr>
                        <tr>
                            <td>
                                Motion detector
                            </td>
                            <td id="alarm_motion">
                            </td>
                        </tr>
                        <tr>
                            <td>
                                Siren
                            </td>
                            <td id="alarm_siren">
                            </td>
                        </tr>
                        <tr>
                            <td>
                                IR Lamp
                            </td>
                            <td id="alarm_lamp">
                            </td>
                        </tr>
                        <tr>
                            <td>
                                Ambient lighting
                            </td>
                            <td>
                                <span id="alarm_light">---</span> <span style="color:gray;font-weight: normal">(0=pitch-black to 255=bright)</span>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                Temperature
                            </td>
                            <td id="alarm_temperature">
                                ---
                            </td>
                        </tr>
                        <tr>
                            <td>
                                Humidity
                            </td>
                            <td id="alarm_humidity">
                                ---
                            </td>
                        </tr>
                    </table>
                    <table class="grid">
                        <tr>
                            <td><div id="alarm_siren_button"></div></td>
                            <td><div id="alarm_lamp_button"></div></td>
                        </tr>
                    </table>
                    <br/><br/>
                    <b>Security Alarm settings</b>
                    <table class="input">
                        <tbody>
                            <tr>
                                <td>
                                    The number of detected movements
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <input type="text" id="alarm_movments" name="alarm_movments" />
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Within this number of seconds
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <input type="text" id="alarm_movments_seconds" name="alarm_movments_seconds" />
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Will lead to an alarm for this number of seconds
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <input type="text" id="alarm_seconds" name="alarm_seconds" />
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Wait this long after an alarm has occurred until a new can fire
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <input type="text" id="alarm_wait" name="alarm_wait" />
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    When ambient lighting under this, activate the IR-lamp. ((0=pitch-black to 255=bright))
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <input type="text" id="alarm_light_acivate" name="alarm_light_acivate" />
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table style="margin-top:3px;margin-bottom:4px">
                        <tbody>
                            <tr>
                                <td style="width:25px">
                                    <input type="checkbox" id="alarm_activate_siren" name="alarm_activate_siren" value="True">
                                </td>
                                <td>
                                    <label for="alarm_activate_siren">Aktivate the siren on alarm</label>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table style="margin-top:3px;margin-bottom:4px">
                        <tbody>
                            <tr>
                                <td style="width:25px">
                                    <input type="checkbox" id="alarm_mail" name="alarm_mail" value="True">
                                </td>
                                <td>
                                    <label for="alarm_mail">Send mail on alarm</label> (You must <a href="#" onclick="javascript:showLayer('mail');">configure mail notification</a> for this to work)
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table style="margin-top:3px;margin-bottom:4px">
                        <tbody>
                            <tr>
                                <td style="width:25px">
                                    <input type="checkbox" id="alarm_remote_siren" name="alarm_remote_siren" value="True">
                                </td>
                                <td>
                                    <label for="alarm_remote_siren">Activate siren on alarm from other device</label>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <button onclick="javascript:submitSyncFromInput('alarm_settings', 'alarm_movments', 'alarm_movments_seconds', 'alarm_seconds', 'alarm_wait', 'alarm_activate_siren', 'alarm_mail', 'alarm_light_acivate', 'alarm_remote_siren')">Save</button>
                    <br/><br/><br/>
                    <table class="input">
                        <tbody>
                            <tr>
                                <td>
                                    <b>Name of device</b> (Will take effect after next reboot)
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <input type="text" id="hostname_name" name="hostname_name" />
                                    <button onclick="javascript:submitSyncFromInputConfirm('Are you sure you want to change hostname?', 'hostname_set', 'hostname_name')">Change name of device</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <br/><br/>
                    <table>
                        <tbody>
                            <tr>
                                <td>
                                    <b>Connect mutiple devices</b><br/>
                                    One device is the server and the rest clients.<br/>
                                    On the server you then can see the clients, you only need to watch one device instead of all...<br/>
                                    If you change this you will get "Connection error" while service restart...you need to refresh the browser.
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="keyvalue">
                        <tr>
                            <td>
                                Current status:
                            </td>
                            <td id="socket_info">
                            </td>
                        </tr>
                        <tr>
                            <td>
                                Connection(s):
                            </td>
                            <td id="socket_connections">
                            </td>
                        </tr>
                    </table>
                    <br/>
                    <table>
                        <tbody>
                            <tr>
                                <td>
                                    <button id="socket_button_server" onclick="javascript:submitSync('socket_server');">Enable as server</button>
                                </td>
                                <td>
                                    <button id="socket_button_disable_server" onclick="javascript:submitSync('socket_disable');">Disable server</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <br/>
                    <table>
                        <tbody>
                            <tr>
                                <td>
                                    Address to server:
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <input type="text" id="socket_client_host"></input>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table>
                        <tbody>
                            <tr>
                                <td>
                                    <button id="socket_button_client" onclick="javascript:submitSyncFromInput('socket_client', 'socket_client_host');">Enable as client / Change address</button>
                                </td>
                                <td>
                                    <button id="socket_button_disable_client" onclick="javascript:submitSync('socket_disable');">Disable client</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <br/><br/>
                    <b>Disable the alarm functionality</b>
                    <table>
                        <tr>
                            <td>If you disable the alarm you may get "Connection error" while service restart...you need to refresh the browser.</td>
                        </tr>
                        <tr>
                            <td><button onclick="javascript:submitSync('alarm', 'false');">Disable Alarm/Surveillance</button></td>
                        </tr>
                    </table>
                </div>
                <br/><br/>
                <table class="footer">
                    <tr onclick="javascript:onBack();">
                        <td>
                            <img alt="logo" src="img/back.png"></img>
                        </td>
                        <td>
                            Back to main menu
                        </td>
                    </tr>
                </table>
            </div>
            <!--####################################################################################################-->
            <div class="layer" id="alarm_server">
                <table class="sheader">
                    <tr onclick="javascript:onBack();">
                        <th>
                            <img alt="logo" src="img/alarm-panel.png"></img>
                        </th>
                        <th>Alarm/Surveillance Server</th>
                    </tr>
                </table>
                <div id="alarm_server_disabled" class="hide">
                    The Alarm/Surveillance functionality is not enabled on this system.<br/>
                    You muste enable it and also activate this device as a server, you can do it <a href="javascript: showLayer('alarm');">here</a>.
                </div>
                <div id="alarm_server_not_server" class="hide">
                    This device is not acivated as server.<br/>
                    You can do it on the bottom of <a href="javascript: showLayer('alarm_server');">this</a> page.
                </div>
                <div id="alarm_server_enabled" class="hide">
                    List of this and all other devices that is a client to this server.<br/>
                    For more info see <a href="http://www.steelsquid.org/alarm">http://www.steelsquid.org/alarm</a>
                    <br/><br/>
                    <table style="width:225px">
                        <tr>
                            <td style="width:50%"><button onclick="javascript:submitSync('alarm_client_set', 'True')">Arm all</button></td>
                            <td style="width:50%"><button onclick="javascript:submitSync('alarm_client_set', 'False')">Disarm all</button></td>
                        </tr>
                    </table>
                    <br/>
                    <table id="alarm_server_statuses">
                        <tbody>
                        </tbody>
                    </table>
                </div>
                <br/><br/>
                <table class="footer">
                    <tr onclick="javascript:onBack();">
                        <td>
                            <img alt="logo" src="img/back.png"></img>
                        </td>
                        <td>
                            Back to main menu
                        </td>
                    </tr>
                </table>
            </div>
            <!--####################################################################################################-->
            <div class="layer" id="mail">
                <table class="header">
                    <thead>
                        <tr onclick="javascript:showLayer('alarm');">
                            <th>
                                <img alt="logo" src="img/mail.png"></img>
                            </th>
                            <th>
                                Alarm/Surveillance Email
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="2">
                                Fill this out if you want an email on security alarm.<br />
                                <br/>
                                Contact your ISP for this information.<br/>
                                <br>
                                It is also possible to use a gmail account.<br/>
                                SMTP server: <span class="highlight">smtp.gmail.com:587</span><br/>
                                Username: Your gmail user (without @gmail.com)<br/>
                                Password: Your gmail password<br>
                                You must do this: <a href="https://support.google.com/accounts/answer/6010255?vid=1-635790602759465538-2791292056">https://support.google.com/accounts/answer/6010255?vid=1-635790602759465538-2791292056</a>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <table class="input">
                    <tbody>
                        <tr>
                            <td>
                                SMTP server
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input type="text" id="mail_host"></input>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                Username (If not required leave blank)
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input type="text" id="mail_username"></input>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                Password (If not required leave blank)
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input type="password" id="mail_password"/>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                Email that you want notification sent to
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input type="text" id="mail_mail"/>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <table class="input">
                    <tr>
                        <td>
                            <button onclick="javascript:submitSyncFromInput('mail_set', 'mail_host', 'mail_username', 'mail_password', 'mail_mail')">Save</button>
                        </td>
                        <td>
                            <button onclick="javascript:submitSyncFromInput('mail_test', 'mail_host', 'mail_username', 'mail_password', 'mail_mail')">Test settings</button>
                        </td>
                    </tr>
                </table>
                <br/>
                <table class="footer">
                    <tr onclick="javascript:showLayer('alarm');">
                        <td>
                            <img alt="logo" src="img/back.png"></img>
                        </td>
                        <td>
                            Back to Alarm/Surveillance
                        </td>
                    </tr>
                </table>
            </div>
            <!--####################################################################################################-->
            <div class="layer" id="rover">
                <table class="sheader">
                    <tr onclick="javascript:onBack();">
                        <th>
                            <img alt="logo" src="img/rover.png"></img>
                        </th>
                        <th>Rover Controller</th>
                    </tr>
                </table>
                <div id="rover_disabled" class="hide">
                    The Rover Controller is not enabled on this system.<br/>
                    Enable Rover Controller may take a minute to perform and you need to reload this page afterwards (you may get connection error).<br/>
                    <br/>
                    <table>
                        <tr>
                            <td><button onclick="javascript:submitSyncFromPrompt('rover_enable', 'Please enter password for the user root?', '');">Enable Rover Controller</button></td>
                        </tr>
                    </table>
                </div>
                <div id="rover_enabled" class="hide">
                    The Rover Controller is enabled on this system.
                    <br/><br/>
                    <table class="keyvalue">
                        <tr>
                            <td>Battery voltage:</td><td id="rover_voltage">---</td>
                        <tr>
                        </tr>
                            <td>Light:</td><td id="rover_light">---</td>
                        <tr>
                        </tr>
                            <td>Alarm:</td><td id="rover_alarm">---</td>
                        </tr>
                    </table>
                    <table>
                        <tr>
                            <td style="width:50%"><button id="rov_normal" onclick="javascript:$('#rover_img').removeClass('rotate-180');$('#rov_normal').css({'text-decoration':'underline'});;$('#rov_flip').css({'text-decoration':'none'});">Cam norm</button></td>
                            <td style="width:50%"><button id="rov_flip" style="text-decoration: underline;" onclick="javascript:$('#rover_img').removeClass('rotate-180').addClass('rotate-180');$('#rov_normal').css({'text-decoration':'none'});;$('#rov_flip').css({'text-decoration':'underline'});">Came rotate</button></td>
                        </tr>
                    </table>
                    <br/>
                    Below you should see the video from the USB camera.
                    <br/>
                    <img alt="The stream" id="rover_img" style="max-width: 100%; min-width: 100%" src="" class="rotate-180"/>
                    <br/><br/>
                    <table style="width:100%">
                        <tr>
                            <td style="width:33%"><button onclick="javascript:submitAsync('rover_tilt', 'True');">Tilt up</button></td>
                            <td style="width:33%"><button style="font-weight:bold" onclick="javascript:submitAsync('rover_forward');">Forward</button></td>
                            <td style="width:33%"><button onclick="javascript:submitSync('rover_light');">Toggle light</button></td>
                        </tr>
                        <tr>
                            <td style="width:33%"><button style="font-weight:bold" onclick="javascript:submitAsync('rover_left');">Left</button></td>
                            <td style="width:33%"><button style="font-weight:bold" onclick="javascript:submitAsync('rover_stop');">Stop</button></td>
                            <td style="width:33%"><button style="font-weight:bold" onclick="javascript:submitAsync('rover_right');">Right</button></td>
                        </tr>
                        <tr>
                            <td style="width:33%"><button onclick="javascript:submitAsync('rover_tilt', 'false');">Tilt down</button></td>
                            <td style="width:33%"><button style="font-weight:bold" onclick="javascript:submitAsync('rover_backward');">Backward</button></td>
                            <td style="width:33%"><button onclick="javascript:submitSync('rover_alarm');">Toggle alarm</button></td>
                        </tr>
                    </table>
                    <br/><br/>
                    Disable Rover Controller may take a minute to perform and you need to reload this page afterwards (you may get connection error).<br/>
                    <table>
                        <tr>
                            <td><button onclick="javascript:submitSyncFromPrompt('rover_disable', 'Please enter password for the user root?', '');">Disable Rover Controller</button></td>
                        </tr>
                    </table>
                </div>
                <br />
                <table class="footer">
                    <tr onclick="javascript:onBack();">
                        <td>
                            <img alt="logo" src="img/back.png"></img>
                        </td>
                        <td>
                            Back to main menu
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </body>
</html>
